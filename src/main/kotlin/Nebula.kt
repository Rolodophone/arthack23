import org.openrndr.Program
import org.openrndr.extra.noise.Random
import org.openrndr.extra.noise.uniformRing
import org.openrndr.math.Vector2
import org.openrndr.shape.LineSegment
import org.openrndr.shape.contour

class Nebula(private val program: Program) {
	val particles = mutableListOf<Particle>()
	var particleBehaviour = ParticleBehaviour.Murmur(program)
	var frameNumber = 0

	fun setup() {
		particleBehaviour.apply {
			friction = 0.99
			simplexSeed = 0
			simplexScale = 0.005
			simplexSpeed = 0.005
			simplexWeight = 0.01
			nearScreenEdgeAccel = 0.01
			gravityWeight = 0.0
			repulsionWeight = 0.001
			contourAttraction = 0.1
            contourAttractionReach = 100.0
            contourAttractionNormalised = true
			contourAccel = 0.02
			totalVelWeight = 1.0
			contour = contour {
				moveTo(269.5555,536.524,)
				curveTo(265.744,515.734,235.56,506.879,231.47899999999998,486.08900000000006,)
				curveTo(220.8145,432.57400000000007,254.579,379.0590000000001,272.63550000000004,327.46899999999994,)
				curveTo(286.80350000000004,287.044,297.237,242.84600000000003,325.11100000000005,210.3135,)
				curveTo(354.60200000000003,175.81749999999997,395.64300000000003,148.3285,439.148,136.201,)
				curveTo(476.108,126.0755,521.5380000000001,119.3765,553.493,140.32049999999995,)
				curveTo(571.5880000000001,152.217,575.053,178.24300000000002,581.2130000000001,198.9945,)
				curveTo(586.218,215.588,581.2130000000001,234.761,588.528,250.43050000000002,)
				curveTo(595.843,265.869,628.183,272.029,623.5630000000001,288.58399999999995,)
				curveTo(621.638,295.899,607.008,288.96899999999994,602.003,294.744,)
				curveTo(588.143,310.529,605.468,340.55899999999997,592.763,357.499,)
				curveTo(577.363,377.519,531.1630000000001,364.8140000000001,523.8480000000001,388.6840000000001,)
				curveTo(503.443,452.59400000000005,567.353,528.8240000000001,625.488,562.319,)
				curveTo(651.283,576.9490000000001,685.548,568.479,714.423,562.319,)
				curveTo(792.578,545.7640000000001,920.783,442.19900000000007,933.103,466.45399999999995,)
				curveTo(939.263,478.3890000000001,904.228,486.08900000000006,909.618,498.409,)
				curveTo(919.628,522.279,985.078,482.624,986.6180000000002,508.804,)
				curveTo(988.928,546.534,911.158,520.739,876.508,536.524,)
				curveTo(825.6880000000001,559.624,781.028,600.4340000000001,738.678,632.774,)
				curveTo(693.633,667.0390000000001,646.6630000000001,664.344,599.693,658.954,)
				curveTo(575.053,655.874,531.548,628.154,531.548,628.154,)
				lineTo(456.47300000000007,816.419,)
				curveTo(456.47300000000007,816.419,578.903,817.9590000000001,634.728,839.134,)
				curveTo(684.393,857.614,750.613,878.0190000000001,766.398,928.454,)
				curveTo(782.183,977.7340000000002,715.578,1022.009,712.113,1073.599,)
				curveTo(754.8480000000001,1535.9840000000002,124.83399999999999,1535.2140000000002,553.8779999999999,1047.034,)
				curveTo(565.043,1034.329,594.303,1027.784,589.683,1011.999,)
				curveTo(571.5880000000001,952.3239999999998,468.023,982.739,406.42300000000006,975.424,)
				curveTo(344.515,967.7239999999999,280.4125,980.8140000000001,219.62100000000004,966.954,)
				curveTo(203.836,963.489,182.9305,962.3340000000001,174.88400000000001,948.0890000000002,)
				curveTo(149.243,903.4290000000001,183.93150000000003,845.294,194.442,794.859,)
				curveTo(212.65250000000003,707.079,285.764,624.6890000000001,269.5555,536.524,)
				close()
			}

            repeat(10000) {
                particles.add(Particle(Random.double0(program.width.toDouble()),
                                       Random.double0(program.height.toDouble())))
            }
		}
	}

	fun update() {
		when (frameNumber) {

		}

		particleBehaviour.update(particles)
		particles.forEach { particleBehaviour.updateParticle(it, frameNumber) }

		frameNumber++
	}

	fun draw() {
		program.drawer.points {
			particles.forEach { it.draw(this) }
		}
	}
}